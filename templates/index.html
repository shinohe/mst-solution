{% extends "base_layout.html" %}
{% block content %}

<style >
h2.ui-bar{
	font-size: 13px;
	margin: 0.5em 0;
}
.listThumbnail{
	width:100px;
	height:145px;
}
div.indexContent, div.indexContent div {
	min-height: auto;
}

div.sumbnail div.ui-bar {
	font-size: 13px !important;
	padding: 0.3em 0.5em;
}

div.sumbnail div.ui-bar .ui-btn {
	margin: 0 auto;
}

.listTitle {
	font-weight: 400;
	font-size: x-small;
	white-space: normal;
	overflow: hidden;
	text-align: center;
	height:3em;
}
.listGenre {
	font-weight: 400;
	font-size: xx-small;
	max-height: 1em;
}

.listShowDate {
	font-weight: 400;
	font-size: xx-small;
}

.pageArea {
	margin-top: 10px;

}

#pageBack,#pageNext{
	height:80px;
	line-height: 80px;
	font-size: 21px;
}

div.favoritIcon {
	background-image:url('/static/css/css-image/favorit.png');
	width: 18px;
	height: 18px;
	background-size: contain;
	font-size: 14px;
}

div.favoritIconOn {
	background-image:url('/static/css/css-image/favorit-on.png');
	width: 18px;
	height: 18px;
	background-size: contain;
	font-size: 14px;
}
div.ui-bar span.selectFavorit {
	background-color:#ec4 !important;
}

div#asumi-frame-440-1833{
	position:fixed !important;
}

table {
	margin: 0.2em;
	border-collapse:separate;
	-webkit-border-radius: 10px;
	-moz-border-radius: 10px;
	border-radius: 10px;
	background-color:#A9DFFF;
}

th:first-child {
	-webkit-border-radius: 10px 0 0 0;
	-moz-border-radius: 10px 0 0 0;
	border-radius: 10px 0 0 0;
}
th:last-child {
	-webkit-border-radius: 0 10px 0 0;
	-moz-border-radius: 0 10px 0 0;
	border-radius: 0 10px 0 0;
}
th,
td {
	padding: 0.2em;
	text-align:left;
	vertical-align:middle;
	word-wrap: break-word;
}

th {
	background-color:#A9DFFF;
}

th.name {
	min-width:10em;
}

th.rarelity,
th.zokusei,
th.bukiShubetsu,
th.delete {
	width:auto;
}

td {
	background-color:#FFFFFF;
}

tr:last-child td:first-child{
	-webkit-border-radius: 0 0 0 10px;
	-moz-border-radius: 0 0 0 10px;
	border-radius: 0 0 0 10px;
}

tr:last-child td:last-child{
	-webkit-border-radius: 0 0 10px 0;
	-moz-border-radius: 0 0 10px 0;
	border-radius: 0 0 10px 0;
}
</style>
<script type="text/javascript">
var page = 1;
var searchFlag = false;

var successCallBack = function(msg){
	$(".indexContent").children("table.unitData").remove();
	
	var thumNailList = JSON.parse(msg.list);
	if (thumNailList.length > 0) {
		var $table = $("<table class='unitData'></table>")
		var $tableHead = $("<tr><th class='name'>ユニット名</th><th class='rarelity'>★</th><th class='zokusei'>属性</th><th class='bukiShubetsu'>武器種</th><th class='dps'>DPS</th><th class='delete'>×</th></tr>");
		$table.append($tableHead);
		$.each(thumNailList, function( index, file){
			unitName = file.name.replace("」", "」<br/>");
			var $div = $("<tr><td>"+unitName+"</td><td class='rarelity'>"+file.rare+"</td><td>"+file.zokusei+"</td><td>"+file.bukiShubetsu+"</td><td>"+Math.round(file.kakuseiKougeki/file.kougekiKankaku)+"</td><td><input type='button' class='delIcon' value='×'></div></td></tr>");
			
			$table.append($div);
		});
		$(".indexContent").append($table);
	}
	console.log(thumNailList);
	if (thumNailList.length < 1) {
		hideLoading();
		$fieldset = $("<fieldset class='ui-grid-solo'><div class='ui-block-a noData'>対象のデータがありません。</div></fieldset>");
		$(".indexContent").append($fieldset);
	}
	hideLoading();

	
	if (page >= msg.maxSize) {
		$("#pageNext").hide();
	}  else {
		$("#pageNext").show();
	}
	 if(page == 1) {
		$("#pageBack").hide();
	} else {
		$("#pageBack").show();
	}
};

var latestList = function(){
	showLoading();
	$.ajax({
		type: "POST",
		url: "/Latest/list",
		contentType: "application/json",
		data:'{"page":' + page + ', "pageSize":8}',
		dataType: "json",
		success: function(msg){
			successCallBack(msg);
		}
	});
};

var searchList = function(){
	showLoading();
	$.ajax({
		type: "POST",
		url: "/Search/list",
		contentType: "application/json",
		data:'{"page":' + page + ',"unitName":"'+$("#searchText").val()+'", "pageSize":5}',
		dataType: "json",
		success: function(msg){
			successCallBack(msg);
		}
	});
};

var pageChange = function(){
	if (searchFlag) {
		searchList();
	} else {
		latestList();
	}
};

var onKeyEvent = function(code)
{
	//エンターキー押下なら
	if(13 === code)
	{
		$("#searchButton").click();
	}
}

function initializeContents(){
	if (navigator.userAgent.toLowerCase().match(/webkit|msie 5/)) {
		// Webkit系（Safari, Chrome, iOS）、IE5はbody要素
		documentElement = document.body;
	} else {
		// IE（6以上）、Firefox、Operaはhtml要素
		documentElement = document.documentElement;
	}
	
	$("#searchButton").click(function(){
		page = 1;
		showLoading();
		searchList();
		searchFlag = true;
	});
	
	$("#pageBack").click(function(){
		page = page -1;
		if (page < 1) {
			page = 1;
		}
		pageChange();
	});
	$("#pageNext").click(function(){
		page = page +1;
		pageChange();
	});
}
</script>

<div id="headerArea" data-role="page">
	<div data-role="header"><h1>メルスト計算機</h1></div>
	<div data-role="content">
		<div class="form">
			<div class="container indexContent">
				<div class="searchArea">
					<input type="text" id="searchText" placeholder="ユニット検索" onkeypress="onKeyEvent(event.keyCode);"/>
					<input type="button" id="searchButton" value="検索"/>
				</div>
			</div>
		</div>
	</div>
</div>

{% endblock %}
